"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var XBCIM=function o(){function n(o){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";o&&o instanceof Function&&o(n)}function e(o){return o=o||"",!/\S+/.test(o)}var t,r={};o.prototype.init=function(n){t&&t.close(),o.token="string"==typeof n?n||"":n.token||"",o.host=n.host||"wss://im.xiangbaicheng.com",e(o.token)||(t=uni.connectSocket({url:o.host+"/chat?token="+encodeURIComponent(o.token),success:function(){}}))},o.prototype.onerror=function(){var o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};o&&o instanceof Function?r.onerror=o:r.onerror(o),t&&t.onError(function(e){n(o,e)})},o.prototype.onsuccess=function(){var o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};t&&t.onOpen(o)},o.prototype.sendSingle=function(){var o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(1==t.readyState){if(e(o.source))return console.error("参数source无效");if(e(o.target))return console.error("参数target无效");if(e(o.content))return console.error("参数content无效");var n=JSON.parse(JSON.stringify(o));n.msgType=n.msgType||"text",n.type="single",t.send({data:JSON.stringify(n)})}},o.prototype.sendGroup=function(){var o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(1==t.readyState){if(e(o.source))return console.error("参数source无效");if(e(o.target))return console.error("参数target无效");if(e(o.content))return console.error("参数content无效");var n=JSON.parse(JSON.stringify(o));n.msgType=n.msgType||"text",n.type="group",t.send({data:JSON.stringify(n)})}},o.prototype.onmessage=function(){var o=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};t&&t.onMessage(function(e){if(n&&n instanceof Function){var t=JSON.parse(e.data);switch(t.type){case 1:1e3==t.code?o.onsuccess&&o.onsuccess():o.onerror&&o.onerror(t);break;case 2:t.data&&n(JSON.parse(t.data))}}})},o.prototype.onclose=function(){var o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};t&&t.onClose(o)},o.prototype.close=function(){var o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};t&&t.close(),this.onclose(o)},o.prototype.reconnect=function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];t&&t.close(),t=uni.connectSocket({url:o.host+"/chat?token="+encodeURIComponent(o.token),success:function(){}})}};exports.default=new XBCIM;