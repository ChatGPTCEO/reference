{"version":3,"sources":["uni-app:///main.js","webpack:///D:/reference/COOL聊天带后端/pages/chat/index.vue?802c","webpack:///D:/reference/COOL聊天带后端/pages/chat/index.vue?8b58","webpack:///D:/reference/COOL聊天带后端/pages/chat/index.vue?0936","webpack:///D:/reference/COOL聊天带后端/pages/chat/index.vue?cc51","uni-app:///pages/chat/index.vue?vue&type=script&lang=ts&setup=true&","webpack:///D:/reference/COOL聊天带后端/pages/chat/index.vue?1fa2"],"names":["wx","__webpack_require_UNI_MP_PLUGIN__","__webpack_require__","createPage","Page"],"mappings":"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","file":"pages/chat/index.js","sourcesContent":["import 'uni-pages';\n// @ts-ignore\nwx.__webpack_require_UNI_MP_PLUGIN__ = __webpack_require__;\nimport Vue from 'vue'\nimport Page from './pages/chat/index.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./index.vue?vue&type=template&id=3fea99d8&scoped=true&\"\nvar renderjs\nimport script from \"./index.vue?vue&type=script&lang=ts&setup=true&\"\nexport * from \"./index.vue?vue&type=script&lang=ts&setup=true&\"\nimport style0 from \"./index.vue?vue&type=style&index=0&id=3fea99d8&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!C:\\\\Program Files\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\runtime\\\\componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"3fea99d8\",\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pages/chat/index.vue\"\nexport default component.exports","export * from \"-!C:\\\\Program Files\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\templateLoader.js??vue-loader-options!C:\\\\Program Files\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--16-0!C:\\\\Program Files\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\template.js!C:\\\\Program Files\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-uni-app-loader\\\\page-meta.js!C:\\\\Program Files\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!C:\\\\Program Files\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./index.vue?vue&type=template&id=3fea99d8&scoped=true&\"","var components\ntry {\n  components = {\n    clPage: function() {\n      return import(\n        /* webpackChunkName: \"node-modules//@/cool/ui/components/cl-page/cl-page\" */ \"/@/cool/ui/components/cl-page/cl-page.vue\"\n      )\n    },\n    clTopbar: function() {\n      return import(\n        /* webpackChunkName: \"node-modules//@/cool/ui/components/cl-topbar/cl-topbar\" */ \"/@/cool/ui/components/cl-topbar/cl-topbar.vue\"\n      )\n    }\n  }\n} catch (e) {\n  if (\n    e.message.indexOf(\"Cannot find module\") !== -1 &&\n    e.message.indexOf(\".vue\") !== -1\n  ) {\n    console.error(e.message)\n    console.error(\"1. 排查组件名称拼写是否正确\")\n    console.error(\n      \"2. 排查组件是否符合 easycom 规范，文档：https://uniapp.dcloud.net.cn/collocation/pages?id=easycom\"\n    )\n    console.error(\n      \"3. 若组件不符合 easycom 规范，需手动引入，并在 components 中注册该组件\"\n    )\n  } else {\n    throw e\n  }\n}\nvar render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  var m0 = _vm.setRefs(\"tools\")\n  var m1 = _vm.setRefs(\"tools\")\n  var m2 = _vm.setRefs(\"emoji\")\n  var m3 = _vm.setRefs(\"emoji\")\n  var m4 = _vm.setRefs(\"microphone\")\n  var m5 = _vm.setRefs(\"microphone\")\n  _vm.$mp.data = Object.assign(\n    {},\n    {\n      $root: {\n        m0: m0,\n        m1: m1,\n        m2: m2,\n        m3: m3,\n        m4: m4,\n        m5: m5\n      }\n    }\n  )\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!C:\\\\Program Files\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\babel-loader\\\\lib\\\\index.js!C:\\\\Program Files\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\ts-loader\\\\index.js??ref--13-1!C:\\\\Program Files\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--13-2!C:\\\\Program Files\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\script.js!C:\\\\Program Files\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!C:\\\\Program Files\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./index.vue?vue&type=script&lang=ts&setup=true&\"; export default mod; export * from \"-!C:\\\\Program Files\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\babel-loader\\\\lib\\\\index.js!C:\\\\Program Files\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\ts-loader\\\\index.js??ref--13-1!C:\\\\Program Files\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--13-2!C:\\\\Program Files\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\script.js!C:\\\\Program Files\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!C:\\\\Program Files\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./index.vue?vue&type=script&lang=ts&setup=true&\"","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nimport { computed, nextTick, provide, reactive, ref } from \"vue\";\nimport MessageList from \"./components/message-list.vue\";\nimport Microphone from \"./components/microphone.vue\";\nimport Tools from \"./components/tools.vue\";\nimport Emoji from \"./components/emoji.vue\";\n\nimport { useCool, useStore, socket } from \"/@/cool\";\nimport { onReady, onShow } from \"@dcloudio/uni-app\";\nimport { debounce, isString } from \"lodash\";\nimport { getRect } from \"/@/cool/utils\";\nimport { Message } from \"/@/types\";\nimport { useChat } from \"/@/hooks\";\n\nconst { safeAreaInsets } = uni.getSystemInfoSync();\n\nconst { refs, setRefs, service, router, ui, mitt } = useCool();\n\n// 缓存\nconst { user } = useStore();\n\n// 聊天\nconst { session } = useChat();\n\n// 消息列表\nconst list = ref<Message.Item[]>([]);\n\n// 加载中\nconst loading = ref<boolean>(false);\n\n// 标题\nconst title = ref<string>(\"\");\n\n// 滚动高度\nconst scroller = reactive<{ top: number; animation: boolean }>({\n\ttop: 0,\n\tanimation: false,\n});\n\n// 面板\nconst panel = reactive<any>({\n\theight: 0,\n\tname: \"\",\n});\n\n// 键盘高度\nconst keyBoardHeight = ref<number>(0);\n\n// 内容输入\nconst input = reactive<any>({\n\ttext: \"\",\n\tfocus: false,\n});\n\n// 页面高度\nconst height = computed(() => {\n\treturn keyBoardHeight.value > 0\n\t\t? `calc(100% - ${keyBoardHeight.value - (safeAreaInsets?.bottom || 0)}px)`\n\t\t: \"100%\";\n});\n\n// 监听键盘高度\nfunction onKeyBoardHeightChange(e: any) {\n\tkeyBoardHeight.value = e.detail.height;\n}\n\n// 打开，关闭面板\nfunction openPanel(action: string) {\n\tpanel.name = action == \"close\" ? \"\" : panel.name == action ? \"\" : action;\n\n\tif (!panel.name) {\n\t\tpanel.height = 0;\n\t} else {\n\t\tnextTick(() => {\n\t\t\tuni.createSelectorQuery()\n\t\t\t\t.select(\".panel\")\n\t\t\t\t.boundingClientRect((res) => {\n\t\t\t\t\tpanel.height = res.height + \"px\";\n\t\t\t\t\tscrollBottom();\n\t\t\t\t})\n\t\t\t\t.exec();\n\t\t});\n\t}\n}\n\n// 内容区域事件\nfunction onContainer() {\n\topenPanel(\"close\");\n}\n\n// 输入框聚焦\nfunction onFocus() {\n\topenPanel(\"close\");\n\n\tsetTimeout(() => {\n\t\tscrollBottom();\n\t}, 300);\n}\n\n// 滚动到底部\nconst scrollBottom = debounce(() => {\n\tscroller.animation = true;\n\tscroller.top = 100000 + Math.random();\n}, 300);\n\n// 触摸点\nconst touches = ref<any[]>([]);\n\n// 屏幕触摸\nfunction onTouchMove(e: any) {\n\ttouches.value = e.changedTouches;\n\n\te.stopPropagation();\n\te.preventDefault();\n\n\treturn false;\n}\n\n// 聊天详情\nfunction toDetail() {\n\tconst { userId, groupId } = router.query;\n\n\trouter.push({\n\t\tpath: \"/pages/chat/detail\",\n\t\tquery: {\n\t\t\tuserId,\n\t\t\tgroupId,\n\t\t},\n\t});\n}\n\n// 追加消息\nfunction append(data: Message.Item, isMy?: boolean) {\n\ttry {\n\t\tif (isString(data.content)) {\n\t\t\tdata.content = JSON.parse(data.content);\n\t\t}\n\t} catch (err) {\n\t\tdata.content = {};\n\t}\n\n\tif (isMy) {\n\t\tdata.mode = \"send\";\n\t}\n\n\t// 开启滚动\n\tscroller.animation = true;\n\n\t// 添加\n\tlist.value.push(data);\n\n\t// 滚动到底\n\tscrollBottom();\n}\n\n// 发送消息\nfunction send(data: Message.Item, isAppend?: boolean) {\n\tif (session.info) {\n\t\tconst { type, sessionId, objectId } = session.info;\n\n\t\t// 合并\n\t\tObject.assign(data, {\n\t\t\tuser: user.info,\n\t\t\ttype,\n\t\t\tsessionId,\n\t\t\tobjectId,\n\t\t\tfromId: user.info?.id,\n\t\t});\n\n\t\tsocket.send(data);\n\n\t\tif (isAppend) {\n\t\t\tappend(data, true);\n\t\t}\n\n\t\t// 重新获取会话\n\t\tif (!session.info.sessionId) {\n\t\t\tgetSession();\n\t\t}\n\t}\n}\n\n// 文本发送\nfunction onTextSend() {\n\tif (input.text) {\n\t\tsend(\n\t\t\t{\n\t\t\t\tcontentType: 0,\n\t\t\t\tcontent: {\n\t\t\t\t\ttext: input.text,\n\t\t\t\t},\n\t\t\t},\n\t\t\ttrue\n\t\t);\n\n\t\tinput.text = \"\";\n\t}\n}\n\n// 分页\nconst pager = {\n\tpage: 1,\n\tsize: 20,\n\ttotal: 0,\n\tisFinished: false,\n};\n\n// 更多消息\nasync function loadmore() {\n\tif (!loading.value && !pager.isFinished) {\n\t\t// 原位置\n\t\tconst r1 = await getRect(\".list\");\n\n\t\t// 获取记录\n\t\tawait refresh({ page: ++pager.page });\n\n\t\tawait nextTick();\n\n\t\t// 新位置\n\t\tconst r2 = await getRect(\".list\");\n\n\t\t// 关闭动画\n\t\tscroller.animation = false;\n\n\t\t// 滚动到旧位置\n\t\tscroller.top = r2.height - r1.height + Math.random();\n\n\t\t// 防止白屏\n\t\tsetTimeout(() => {\n\n\n\n\t\t}, 30);\n\t}\n}\n\n// 刷新\nasync function refresh(params?: any) {\n\tif (session.info?.sessionId) {\n\t\tloading.value = true;\n\n\t\tconst d = {\n\t\t\tpage: 1,\n\t\t\tsize: 20,\n\t\t\tsessionId: session.info?.sessionId,\n\t\t\t...params,\n\t\t\torder: \"createTime\",\n\t\t\tsort: \"desc\",\n\t\t};\n\n\t\tawait service.chat.message\n\t\t\t.page(d)\n\t\t\t.then((res) => {\n\t\t\t\t// 合并\n\t\t\t\tlist.value.unshift(...res.list.reverse());\n\n\t\t\t\t// 是否加载完\n\t\t\t\tpager.isFinished = res.list.length < d.size;\n\n\t\t\t\t// 读消息\n\t\t\t\tservice.chat.message.read({\n\t\t\t\t\tsessionId: session.info?.sessionId,\n\t\t\t\t\tmessageIds: res.list.map((e) => e.id),\n\t\t\t\t});\n\t\t\t})\n\t\t\t.catch((err) => {\n\t\t\t\tui.showTips(err.message);\n\t\t\t});\n\n\t\tloading.value = false;\n\t}\n}\n\n// 获取会话详情\nasync function getSession() {\n\tawait session.get(router.query).then(() => {\n\t\ttitle.value = session.info?.name || \"会话中\";\n\t});\n}\n\n// 注入\nprovide(\"chat\", {\n\tlist,\n\ttouches,\n\tsend,\n\tappend,\n\tscrollBottom,\n\trefresh,\n});\n\nonReady(async () => {\n\t// 获取会话\n\tawait getSession();\n\n\t// 获取列表\n\tawait refresh();\n\n\t// 滚动到底\n\tscrollBottom();\n\n\t// 接收消息\n\tmitt.on(\"chat-message\", (msg: Message.Item) => {\n\t\tif (router.isCurrentPage(\"/pages/chat/index\")) {\n\t\t\tif (session.info?.sessionId == msg.sessionId) {\n\t\t\t\tappend({\n\t\t\t\t\t...msg.user,\n\t\t\t\t\t...msg,\n\t\t\t\t});\n\n\t\t\t\t// 读消息\n\t\t\t\tservice.chat.message.read({\n\t\t\t\t\tsessionId: session.info?.sessionId,\n\t\t\t\t\tmessageIds: [msg.id],\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t});\n});\n\nonShow(() => {\n\tif (ui.loaded) {\n\t\tgetSession();\n\t}\n});\n","import mod from \"-!C:\\\\Program Files\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\mini-css-extract-plugin\\\\dist\\\\loader.js??ref--8-oneOf-1-0!C:\\\\Program Files\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\css-loader\\\\dist\\\\cjs.js??ref--8-oneOf-1-1!C:\\\\Program Files\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\stylePostLoader.js!C:\\\\Program Files\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--8-oneOf-1-2!C:\\\\Program Files\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\postcss-loader\\\\src\\\\index.js??ref--8-oneOf-1-3!C:\\\\Program Files\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\sass-loader\\\\dist\\\\cjs.js??ref--8-oneOf-1-4!C:\\\\Program Files\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--8-oneOf-1-5!C:\\\\Program Files\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!C:\\\\Program Files\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./index.vue?vue&type=style&index=0&id=3fea99d8&lang=scss&scoped=true&\"; export default mod; export * from \"-!C:\\\\Program Files\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\mini-css-extract-plugin\\\\dist\\\\loader.js??ref--8-oneOf-1-0!C:\\\\Program Files\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\css-loader\\\\dist\\\\cjs.js??ref--8-oneOf-1-1!C:\\\\Program Files\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\stylePostLoader.js!C:\\\\Program Files\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--8-oneOf-1-2!C:\\\\Program Files\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\postcss-loader\\\\src\\\\index.js??ref--8-oneOf-1-3!C:\\\\Program Files\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\sass-loader\\\\dist\\\\cjs.js??ref--8-oneOf-1-4!C:\\\\Program Files\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--8-oneOf-1-5!C:\\\\Program Files\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!C:\\\\Program Files\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./index.vue?vue&type=style&index=0&id=3fea99d8&lang=scss&scoped=true&\""],"sourceRoot":""}