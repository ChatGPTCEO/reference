{"version":3,"sources":["uni-app:///main.js","webpack:///C:/Users/will/Documents/GitHub/reference/美信拓扑即时通讯 IM SDK，为 App 添加聊天功能示例/pages/conversation/index.vue?21cd","webpack:///C:/Users/will/Documents/GitHub/reference/美信拓扑即时通讯 IM SDK，为 App 添加聊天功能示例/pages/conversation/index.vue?0b53","webpack:///C:/Users/will/Documents/GitHub/reference/美信拓扑即时通讯 IM SDK，为 App 添加聊天功能示例/pages/conversation/index.vue?4cdb","webpack:///C:/Users/will/Documents/GitHub/reference/美信拓扑即时通讯 IM SDK，为 App 添加聊天功能示例/pages/conversation/index.vue?d4cc","uni-app:///pages/conversation/index.vue","webpack:///C:/Users/will/Documents/GitHub/reference/美信拓扑即时通讯 IM SDK，为 App 添加聊天功能示例/pages/conversation/index.vue?8e83","webpack:///C:/Users/will/Documents/GitHub/reference/美信拓扑即时通讯 IM SDK，为 App 添加聊天功能示例/pages/conversation/index.vue?1266"],"names":["wx","__webpack_require_UNI_MP_PLUGIN__","__webpack_require__","createPage","Page"],"mappings":";;;;;;;;;;kDAAA;;;AAGA;AACA,oG,8FAHA;AACAA,EAAE,CAACC,iCAAH,GAAuCC,mBAAvC,CAGAC,UAAU,CAACC,cAAD,CAAV,C;;;;;;;;;;;;;ACLA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAkH;AAClH;AACyD;AACL;AACa;;;AAGjE;AAC6L;AAC7L,gBAAgB,2LAAU;AAC1B,EAAE,2EAAM;AACR,EAAE,gFAAM;AACR,EAAE,yFAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,oFAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACvBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;ACRA;AAAA;AAAA;AAAA;AAAouB,CAAgB,qrBAAG,EAAC,C;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACgCxvB;AACA,MADA,kBACA;AACA;AACA,0BADA;AAEA,kBAFA;AAGA;AACA,oBADA;AAEA,qDAFA,EAHA;;;AAQA,GAVA;;AAYA,gBAZA;AAaA,WAbA;AAcA;AACA;;AAEA;AACA;AACA;AACA;AACA,+BADA;;AAGA;AACA,KAPA,MAOA;AACA;AACA;AACA,GA3BA;AA4BA;AACA;AACA,wCADA;;;AAIA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,OANA;AAOA;AACA;AACA,OAFA;AAGA;AACA;AACA,OAFA;AAGA;AACA;AACA,OAFA;;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OARA;AASA;AACA,GA9DA;AA+DA;AACA,qBADA,6BACA,CADA,EACA;AACA;AACA;;AAEA;AACA;AACA,0CADA;;AAGA,OAJA,MAIA;AACA;AACA,yCADA;;AAGA;AACA,KAdA;;AAgBA,uBAhBA,iCAgBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,kCADA;AAEA,iDAFA;;AAIA,SARA,MAQA;AACA;AACA;AACA;AACA;AACA,iCADA;AAEA,yBAFA;AAGA,iDAHA;;AAKA;;AAEA;AACA,yBADA;AAEA,sBAFA;AAGA,oBAHA;AAIA,0BAJA;AAKA,8BALA;AAMA,wBANA;AAOA,wBAPA;AAQA,iBARA;;AAUA,OAtCA;;AAwCA;AACA;AACA,OAFA;AAGA;AACA,mDADA;;AAGA,KArEA,EA/DA,E;;;;;;;;;;;;AChCA;AAAA;AAAA;AAAA;AAA2iC,CAAgB,s8BAAG,EAAC,C;;;;;;;;;;;ACA/jC;AACA,OAAO,KAAU,EAAE,kBAKd","file":"pages/conversation/index.js","sourcesContent":["import 'uni-pages';\n// @ts-ignore\nwx.__webpack_require_UNI_MP_PLUGIN__ = __webpack_require__;\nimport Vue from 'vue'\nimport Page from './pages/conversation/index.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./index.vue?vue&type=template&id=16c0917f&\"\nvar renderjs\nimport script from \"./index.vue?vue&type=script&lang=js&\"\nexport * from \"./index.vue?vue&type=script&lang=js&\"\nimport style0 from \"./index.vue?vue&type=style&index=0&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pages/conversation/index.vue\"\nexport default component.exports","export * from \"-!../../../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--16-0!../../../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./index.vue?vue&type=template&id=16c0917f&\"","var components\nvar render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./index.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./index.vue?vue&type=script&lang=js&\"","<template>\n  <view>\n    <snav>\n      <text class=\"atitle\">美信拓扑</text>\n    </snav>\n    <view class=\"container\" :style=\"'padding-top:' + navHeight + 'px'\">\n      <view v-for=\"(conversation, index) in conversationList\" :key=\"index\" @tap=\"touchConversation\" :data-type=\"conversation.type\" :data-sid=\"conversation.sid\" class=\"item\">\n        <view v-if=\"conversation.unread != 0\" class=\"unread_number\">\n          <text>{{ conversation.unread }}</text>\n        </view>\n\n        <view v-if=\"conversation.sid == 0\">\n          <image :src=\"system_avatar.avatar\" class=\"avatar\"></image>\n          <view class=\"name\">\n            <text>{{ system_avatar.name }}</text>\n          </view>\n        </view>\n        <view v-else>\n          <image :src=\"conversation.avatar\" class=\"avatar\"></image>\n          <view class=\"name\">\n            <text>{{ conversation.name }}</text>\n          </view>\n        </view>\n        <view class=\"last_msg\">\n          <text>{{ conversation.content }}</text>\n        </view>\n      </view>\n    </view>\n  </view>\n</template>\n\n<script>\nexport default {\n  data() {\n    return {\n      conversationList: [],\n      navHeight: 0,\n      system_avatar: {\n        name: '系统通知',\n        avatar: '/static/pages/image/tab/setting.png'\n      }\n    };\n  },\n\n  components: {},\n  props: {},\n  onShow: function () {\n    const token = getApp().getIM().userManage.getToken();\n\n    if (!token) {\n      if (getApp().isLoginPage === false) {\n        getApp().isLoginPage = true;\n        wx.reLaunch({\n          url: '../login/index'\n        });\n      }\n    } else {\n      this.getConversationList();\n    }\n  },\n  onLoad: function () {\n    this.setData({\n      navHeight: getApp().getNavHeight()\n    });\n\n    const im = getApp().getIM();\n    if (im) {\n      im.on('onUnreadChange', (xid) => {\n        // xid is either roster_id or group_id\n        console.log('Got notice: onUnreadChange ', xid);\n\n        // refresh unread\n        this.getConversationList();\n      });\n      im.on('onRosterMessage', (message) => {\n        this.getConversationList();\n      });\n      im.on('onGroupMessage', (message) => {\n        this.getConversationList();\n      });\n      im.on('onRosterListUpdate', (message) => {\n        this.getConversationList();\n      });\n\n      im.on('onDisconnect', () => {\n        // im.userManage.deleteToken();\n        // if (getApp().isLoginPage === false) {\n        //   getApp().isLoginPage = true;\n        //   wx.reLaunch({\n        //     url: '../login/index',\n        //   })\n        // }\n      });\n    }\n  },\n  methods: {\n    touchConversation(e) {\n      var id = e.currentTarget.dataset.sid;\n      const type = e.currentTarget.dataset.type;\n\n      if (type === 'roster') {\n        wx.navigateTo({\n          url: '../roster/index?uid=' + id\n        });\n      } else {\n        wx.navigateTo({\n          url: '../group/index?gid=' + id\n        });\n      }\n    },\n\n    getConversationList() {\n      const im = getApp().getIM();\n      const uid = im.userManage.getUid();\n      let convList = im.userManage.getConversationList();\n      convList = convList.filter((x) => x.id !== uid);\n      const allGroupMap = im.groupManage.getAllGroupDetail();\n      const allRosterMap = im.rosterManage.getAllRosterDetail() || {};\n      const convListWithCount = convList.map((item, index) => {\n        let name;\n        const id = item.id;\n        const content = item.content;\n        const timestamp = item.timestamp;\n        let avatar = '';\n        const unreadCount = item.type == 'roster' ? im.rosterManage.getUnreadCount(id) : im.groupManage.getUnreadCount(id);\n        const unread = unreadCount > 0 ? unreadCount : 0;\n\n        if (item.type === 'roster') {\n          //roster\n          const sroster = allRosterMap[id] || { user_id: id };\n          name = sroster.nick_name || sroster.username || sroster.user_id;\n          avatar = im.sysManage.getImage({\n            avatar: sroster.avatar,\n            sdefault: '/static/pages/image/r.png'\n          });\n        } else if (item.type === 'group') {\n          //group\n          const sgroup = allGroupMap[id] || {};\n          name = sgroup.name || id;\n          avatar = im.sysManage.getImage({\n            avatar: sgroup.avatar,\n            type: 'group',\n            sdefault: '/static/pages/image/g.png'\n          });\n        }\n\n        return {\n          type: item.type,\n          index,\n          name,\n          content,\n          timestamp,\n          avatar,\n          unread,\n          sid: id\n        };\n      });\n\n      const sortedConvList = convListWithCount.sort((a, b) => {\n        return a.timestamp < b.timestamp ? 1 : a.timestamp > b.timestamp ? -1 : 0;\n      });\n      this.setData({\n        conversationList: [].concat(sortedConvList)\n      });\n    }\n  }\n};\n</script>\n<style>\n@import './index.css';\n</style>\n","import mod from \"-!../../../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--6-oneOf-1-2!../../../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-3!../../../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./index.vue?vue&type=style&index=0&lang=css&\"; export default mod; export * from \"-!../../../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--6-oneOf-1-2!../../../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-3!../../../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./index.vue?vue&type=style&index=0&lang=css&\"","// extracted by mini-css-extract-plugin\n    if(module.hot) {\n      // 1667473764729\n      var cssReload = require(\"C:/Program Files/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/hmr/hotModuleReplacement.js\")(module.id, {\"hmr\":true,\"publicPath\":\"../../\",\"locals\":false});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  "],"sourceRoot":""}